function loadScript(){var a=document.createElement("script");a.type="text/javascript";a.src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&callback=initialize";document.body.appendChild(a)}window.onload=loadScript;var bounds,infoWnd,map,markerCluster,mapZoom;var markers=[];var mcOptions={styles:[{height:28,width:28,textColor:"#8a2b87",textSize:12,url:"http://media.guggenheim.org/map-navigator/cluster.png"},{height:28,width:28,textColor:"#ff0000",textSize:24,url:"http://media.guggenheim.org/map-navigator/cluster.png"}]};function initialize(){infoWnd=new google.maps.InfoWindow();var a={zoom:2,center:new google.maps.LatLng(0,0),mapTypeId:"roadmap"};map=new google.maps.Map(document.getElementById("map-canvas"),a);markerCluster=new MarkerClusterer(map,markers,mcOptions);var b=[{featureType:"all",stylers:[{visibility:"off"}]},{featureType:"landscape",stylers:[{visibility:"on"},{color:"#999"}]},{featureType:"water",stylers:[{visibility:"on"},{color:"#ffffff"}]}];map.setOptions({styles:b})}function addMarker(b,f,e,d){var a=new google.maps.Marker({position:b,map:map,title:f,icon:"http://media.guggenheim.org/map-navigator/"+d+".png"});bounds.extend(b);google.maps.event.addListener(a,"mouseover",function(){a.setIcon("http://media.guggenheim.org/map-navigator/"+d+"-hover.png")});google.maps.event.addListener(a,"mouseout",function(){a.setIcon("http://media.guggenheim.org/map-navigator/"+d+".png")});google.maps.event.addListener(a,"click",function(){(function(c){c("#"+a.__gm_id).next(".hidden").toggle(function(){c(".hidden:visible").not(this).hide()})})(jQuery);infoWnd.setContent(f+'<img src="http://media.guggenheim.org/map-navigator/'+d+'.png"/>');infoWnd.open(map,a)});if(markers[f]!==f){createSidebarElement(a,e)}markers[f]=f;markers.push(a);map.fitBounds(bounds);var g=map.getCenter();map_recenter(g,150,0);google.maps.event.addListenerOnce(map,"bounds_changed",function(){if(mapZoom!=map.getZoom()){mapZoom=(map.getZoom()-1);map.setZoom(mapZoom)}})}function map_recenter(e,b,a){var d=map.getProjection().fromLatLngToPoint((e instanceof google.maps.LatLng)?e:map.getCenter());var c=new google.maps.Point(((typeof(b)=="number"?b:0)/Math.pow(2,map.getZoom()))||0,((typeof(a)=="number"?a:0)/Math.pow(2,map.getZoom()))||0);map.setCenter(map.getProjection().fromPointToLatLng(new google.maps.Point(d.x-c.x,d.y+c.y)))}function createSidebarElement(b,d){var c=document.getElementById("sidebar");var a=document.createElement("li");var e=b.getTitle();a.innerHTML='<a id="'+b.__gm_id+'" class="toggle">'+e+'</a><div class="hidden" style="display: none">'+d+"</div>";c.appendChild(a);google.maps.event.addDomListener(a,"click",function(){google.maps.event.trigger(b,"click")});google.maps.event.addDomListener(a,"mouseover",function(){for(var f=0;f<markers.length;f++){if(markers[f].title===e){google.maps.event.trigger(markers[f],"mouseover")}}});google.maps.event.addDomListener(a,"mouseout",function(){for(var f=0;f<markers.length;f++){if(markers[f].title===e){google.maps.event.trigger(markers[f],"mouseout")}}})}(function($){$(window).bind("load",function(){setTimeout(function(){$("input:checkbox:first").trigger("click");var request={option:"com_mapnavigator",format:"json","categories[]":$("input:checkbox:first").val(),location:$("input:radio:checked").val()};loadMarkers(request)},1000)});$(document).on("click","form input",function(){var request={option:"com_mapnavigator",format:"json",location:$("input[name=location]:checked").val(),region:$("input[name=region]:checked").val()};request.categories=[];$("input.filters:checked").each(function(i){request.categories[i]=$(this).val()});loadMarkers(request)});function loadMarkers(request){bounds=new google.maps.LatLngBounds();$.ajax({type:"POST",data:request,format:"json",success:function(response){markerCluster.clearMarkers();for(var i=0;i<markers.length;i++){markers[i].setMap(null)}markers=[];var sidebar=document.getElementById("sidebar");while(sidebar.firstChild){sidebar.removeChild(sidebar.firstChild)}var locations=eval("("+response+")");for(var key in locations){if(locations.hasOwnProperty(key)){if(locations[key].hasOwnProperty("image")){locations[key].info='<img src="'+locations[key].image+'"/>'+locations[key].info}var location=new google.maps.LatLng(locations[key].lat,locations[key].lng);addMarker(location,locations[key].title,locations[key].info,locations[key].type)}}markerCluster.addMarkers(markers)}})}})(jQuery);